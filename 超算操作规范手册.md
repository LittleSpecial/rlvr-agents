并行超算 (BSCC-N32-H) 操作规范手册
1. 硬件与架构基础 (Context)
分区名称：BSCC-N32-H

CPU 架构：aarch64 (华为鲲鹏 920, ARM架构)。

注意：安装 Python 包时需注意必须兼容 ARM64 (aarch64) 架构，x86_64 的包无法运行。

GPU 资源：NVIDIA A100 PCIe 40GB。

资源配比：每申请 1块 GPU，系统强制绑定分配 32核 CPU + 55GB 内存。

节点类型：

登录节点 (Login Node)：用于编辑代码、编译、安装环境、下载数据。有互联网访问权限。

计算节点 (Compute Node)：用于运行高负载任务。无互联网访问权限。

2. 严禁事项 (Red Lines)
禁止在登录节点跑计算：

不要在命令行直接运行 python train.py。

登录节点仅限运行 vim, git, pip, cp 以及轻量级编译任务。

违规后果：进程会被管理员自动杀掉，甚至封号。

禁止在计算任务中联网：

作业脚本（run.sh）运行期间无法下载模型或数据（如 HuggingFace/GitHub）。

对策：必须在提交作业前，在登录节点将所有数据/模型下载到本地磁盘。

注意存储配额：

默认配额通常为 300GB (/home/bingxing2/)。超出配额会导致作业写入日志失败从而中断。

3. 标准工作流 (Workflow)
第一阶段：连接与环境配置 (登录节点)
连接节点：

推荐使用 中卫 (Zhongwei) 或 阿里 (Ali) 节点（低延迟）。

若需拉取 GitHub 代码且国内节点失败，可临时切换 香港 (Hong Kong) 节点。

代码同步：

推荐使用 VS Code 直接拖拽上传（最稳妥）。

或配置国内镜像源后使用 git pull。

环境安装 (Conda)：

Bash
# 1. 加载 ARM 版基础模块
module load miniforge3/24.1

# 2. 创建环境
conda create -n rlvr python=3.9 -y
source activate rlvr

# 3. 安装依赖 (必须在登录节点完成)
pip install -r requirements.txt
第二阶段：作业提交 (Slurm 调度)
必须编写 Shell 脚本通过 sbatch 提交。

标准作业脚本模板 (run_job.sh)：

Bash
#!/bin/bash
#SBATCH -J my_experiment       # 作业名称
#SBATCH -p gpu                 # 分区 (必须是 gpu)
#SBATCH -N 1                   # 节点数
#SBATCH --gpus=1               # GPU卡数 (1~4)
#SBATCH --cpus-per-task=32     # CPU核数 (必须是卡数 x 32)
#SBATCH --output=logs/%j.out   # 标准输出日志 (%j 代表作业ID)
#SBATCH --error=logs/%j.err    # 错误日志

# 1. 加载环境 (与登录节点保持一致)
module load miniforge3/24.1
source activate rlvr

# 2. 进入代码目录
cd /home/bingxing2/你的用户名/rlvr-agents

# 3. 运行命令
echo "Job started at $(date)"
python3 paper_a_credit_assignment/train.py --backend toy --env_type code ...
echo "Job finished at $(date)"
第三阶段：监控与调试
提交作业：

Bash
mkdir -p logs  # 首次需要创建日志目录
sbatch run_job.sh
查看状态：

Bash
squeue -u $USER
# 或
parajobs
PD (Pending): 排队中。

R (Running): 运行中。

CG (Completing): 即将结束。

查看实时日志：

Bash
# 找到作业ID (例如 1024)
tail -f logs/1024.out
取消作业：

Bash
scancel 作业ID
4. 常见问题速查 (Troubleshooting)
报错 Command not found: nvidia-smi：

原因：你在登录节点。

解法：不用管，提交到计算节点后自然会有。

报错 HTTPConnectionPool ... Max retries exceeded：

原因：计算节点没网，代码试图下载数据。

解法：在登录节点预先下载数据，或检查代码是否设置了 offline 模式。

报错 Illegal instruction (非法指令)：

原因：安装了 x86 架构的 Python 包。

解法：检查 pip 安装源，寻找 aarch64 版本的 whl 包，或者重装环境。

VS Code 连接卡顿：

原因：连接了香港节点。

解法：修改 SSH Config，换回 ssh.cn-zhongwei-1.paracloud.com。

一句话总结：在登录节点配环境、传数据；写脚本用 sbatch 把任务扔给计算节点跑；用 tail 看日志。